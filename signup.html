<!doctype html><html lang="fr"><head><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/><title>Créer un compte</title><link rel="stylesheet" href="/css/app.css?v=1"/>  <script src="js/hos-ui.js" defer></script>
<script>window.HOS_LOGO_URL='assets/logo.png';</script>
</head>
<body><div class="page"><div class="bg-glow"></div><a class="toplink" href="/">Retour</a>
<div class="shell"><div class="card" style="text-align:left">
<div class="smalltitle">HÉRITAGE</div><div class="h2">Créer un compte</div><div class="p">Renseignez vos informations.</div>
<div class="form-row"><div class="field"><input id="last_name" placeholder="Nom" autocomplete="family-name"/></div><div class="field"><input id="first_name" placeholder="Prénom" autocomplete="given-name"/></div></div>
<div style="height:12px"></div>
<div class="form-row"><div class="field"><input id="phone" placeholder="Téléphone" inputmode="tel" autocomplete="tel"/></div><div class="field"><input id="email" placeholder="Adresse e-mail" inputmode="email" autocomplete="email"/></div></div>
<div style="height:12px"></div>
<div class="form-row"><div class="field"><input id="password" type="password" placeholder="Mot de passe" autocomplete="new-password"/></div><div class="field"><input id="password2" type="password" placeholder="Confirmer le mot de passe" autocomplete="new-password"/></div></div>
<div class="actions" style="justify-content:flex-start;margin-top:12px"><label class="chk"><input id="newsletter" type="checkbox"/><span> </span></label></div>
<div class="actions" style="justify-content:flex-end;margin-top:14px"><button class="btn-arrow" id="signupBtn">→</button></div>
<div class="msg" id="msg"></div><div class="note">8+ caractères, 1 majuscule, 1 minuscule, 1 chiffre.</div>
</div></div></div>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script><script src="/js/config.js?v=1"></script><script src="/js/app.js?v=1"></script>
<script>
(function(){
  const {$, setMsg, pwStrong, makeClient} = window.HeritageApp;
  const msg=$("#msg");
  $("#signupBtn").addEventListener("click", async ()=>{
    setMsg(msg,"");
    const ln=$("#last_name").value.trim(), fn=$("#first_name").value.trim(), ph=$("#phone").value.trim(), em=$("#email").value.trim();
    const pw=$("#password").value, pw2=$("#password2").value, nl=$("#newsletter").checked;
    if(!ln||!fn||!ph||!em){ setMsg(msg,"Remplissez nom, prénom, téléphone et e-mail.","error"); return; }
    if(!pw||!pw2){ setMsg(msg,"Entrez et confirmez le mot de passe.","error"); return; }
    if(pw!==pw2){ setMsg(msg,"Les mots de passe ne correspondent pas.","error"); return; }
    if(!pwStrong(pw)){ setMsg(msg,"Mot de passe trop faible.","error"); return; }

    const {client, error} = makeClient(true);
    if(error||!client){ setMsg(msg,"Configuration Supabase manquante (URL / ANON KEY).","error"); return; }

    $("#signupBtn").disabled=true;
    try{
      const {data, error:err} = await client.auth.signUp({
        email: em, password: pw,
        options:{ data:{ first_name:fn, last_name:ln, phone:ph, newsletter:nl } }
      });
      if(err){ setMsg(msg,"Création impossible. Vérifiez l’e-mail ou réessayez.","error"); return; }
      if(data?.session){ setMsg(msg,"Compte créé. Redirection...","ok"); setTimeout(()=>location.href="/espace/",700); }
      else setMsg(msg,"Compte créé. Vérifiez votre e-mail puis connectez-vous.","ok");
    } finally { $("#signupBtn").disabled=false; }
  });
})();
</script>
</body></html>
